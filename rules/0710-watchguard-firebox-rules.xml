<!--
  -  Decoders for watchguard-firebox
  -  Created by FMI Groupe (ph3nix, Orsiris de Jong) for Wazuh, Inc.
  -  Copyright (C) 2021, FMI Groupe, Wazuh Inc.
  -  This program is a free software; you can redistribute it and/or modify it under the terms of GPLv2.

   Changelog
   2021/07/08 - Orsiris de Jong - Added security event rules
   2021/07/05 - Orsiris de Jong - Added various correlation rules
                                - Added possible traffic and proxy rules
   2021/06/10 - Orsiris de Jong - Added various attack rules (port scan, ddos, ids, flooding, spoofing)
                                - Added possible tunnel attack rules high ICMP, DNS & NTP payloads
                                - Added multiple attack grouping
                                
   2021/04/21 - ph3nix          - Initial release
                                - Authentication, VPN and traffic rules
-->

<group name="syslog,firewall,watchguard,watchguard-fw">
  <rule id="110000" level="0">
    <decoded_as>watchguard-firebox-firewall</decoded_as>
    <description>Grouping of Watchguard Firebox authentication rules</description>
  </rule>
  
  <!-- ## BASIC RULES ## -->
  
  <!-- startup / shutdown rules -->
  <rule id="110001" level="3">
    <if_sid>110000</if_sid>
    <id type="pcre2">3000-002[7|8]</id>
    <description>Watchguard: $(reason)</description>
  </rule>
 
  <!-- licence / features missing or malfunction-->
  <rule id="110002" level="12">
    <if_sid>110000</if_sid>
     <id type="pcre2">(3000-000[4|5])|3000-003A</id>
    <description>Watchguard: $(reason)</description>
  </rule>
  
  <!-- ## ATTACK DETECTION RULES ## -->
  
  <!-- Port scan & Syn flood -->
  <rule id="110011" level="9">
    <if_sid>110000</if_sid>
    <id type="pcre2">3000-0(159|162)</id>
    <description>Watchguard: $(reason) detected from $(srcip) to $(dstip)</description>
    <group>port_scan</group>
  </rule>
  
  <!-- DDoS to -->
  <rule id="110012" level="9">
    <if_sid>110000</if_sid>
    <id>3000-0160</id>
    <description>Watchguard: $(reason) detected against $(dstip)</description>
    <group>ddos</group>
  </rule>
  
  <!-- DDoS from -->
  <rule id="110013" level="9">
    <if_sid>110000</if_sid>
    <id>3000-0161</id>
    <description>Watchguard: $(reason) detected from $(dstip)</description>
    <group>ddos</group>
  </rule>
  
  <!-- Unwanted traffic rules -->
  <rule id="110014" level="9">
    <if_sid>110000</if_sid>
    <id>3000-0168</id>
    <description>Watchguard: Blocked site: Traffic detected from $(srcip) to $(dstip)</description>
    <group>unwanted_traffic,access_denied,pci_dss_10.2.4,pci_dss_11.4,gpg13_4.12,gdpr_IV_35.7.d,tsc_CC6.1,tsc_CC6.8,tsc_CC7.2,tsc_CC7.3,</group>
  </rule>
  
  <rule id="110015" level="10" frequency="10" timeframe="240" ignore="90">
    <if_matched_sid>110014</if_matched_sid>
    <same_srcip />
    <description>Watchguard: Blocked site: Recidiving traffic received from $(srcip)</description>
    <group>unwanted_traffic,access_denied,pci_dss_10.2.4,pci_dss_11.4,gpg13_4.12,gdpr_IV_35.7.d,tsc_CC6.1,tsc_CC6.8,tsc_CC7.2,tsc_CC7.3,</group>
  </rule>
  
  <rule id="110016" level="9">
    <if_sid>110000</if_sid>
    <id>3000-0169</id>
    <description>Watchguard: IP spoofing: Traffic detected from $(srcip) to $(dstip)</description>
    <group>unwanted_traffic,access_denied,pci_dss_10.2.4,pci_dss_11.4,gpg13_4.12,gdpr_IV_35.7.d,tsc_CC6.1,tsc_CC6.8,tsc_CC7.2,tsc_CC7.3,</group>
  </rule>
  
  <rule id="110017" level="10" frequency="10" timeframe="240" ignore="90">
    <if_matched_sid>110016</if_matched_sid>
    <same_srcip />
    <description>Watchguard: IP spoofing: Recidiving traffic received from $(srcip)</description>
    <group>unwanted_traffic,access_denied,pci_dss_10.2.4,pci_dss_11.4,gpg13_4.12,gdpr_IV_35.7.d,tsc_CC6.1,tsc_CC6.8,tsc_CC7.2,tsc_CC7.3,</group>
  </rule>
  
  <rule id="110018" level="9">
    <if_sid>110000</if_sid>
    <id>3000-0172</id>
    <description>Watchguard: Blocked port: Traffic detected from $(srcip) to $(dstip) on port $(dstport)</description>
    <group>unwanted_traffic,access_denied,pci_dss_10.2.4,pci_dss_11.4,gpg13_4.12,gdpr_IV_35.7.d,tsc_CC6.1,tsc_CC6.8,tsc_CC7.2,tsc_CC7.3,</group>
  </rule>
  
  <rule id="110019" level="10" frequency="10" timeframe="240" ignore="90">
    <if_matched_sid>110018</if_matched_sid>
    <same_srcip />
    <description>Watchguard: Blocked port: Recidiving traffic received from $(srcip)</description>
    <group>unwanted_traffic,access_denied,pci_dss_10.2.4,pci_dss_11.4,gpg13_4.12,gdpr_IV_35.7.d,tsc_CC6.1,tsc_CC6.8,tsc_CC7.2,tsc_CC7.3,</group>
  </rule>
  
  <!-- correlation rule for unwanted traffic -->
  <rule id="110020" level="14" frequency="10" timeframe="240" ignore="90">
    <if_matched_group>unwanted_traffic</if_matched_group>
    <description>Watchguard: Multiple unwanted traffic received. Possible attack ongoing</description>
    <group>unwanted_traffic,access_denied,pci_dss_10.2.4,pci_dss_11.4,gpg13_4.12,gdpr_IV_35.7.d,tsc_CC6.1,tsc_CC6.8,tsc_CC7.2,tsc_CC7.3,</group>
  </rule>
  
  <rule id="110021" level="10">
    <if_sid>110000</if_sid>
    <id>3000-012C</id>
    <description>Watchguard: ARP spoofing attack detected, ip=$(srcip), mac=$(srcmac), interface=$(src)</description>
    <group>spoofing,pci_dss_10.6.1,gpg13_4.12,gdpr_IV_35.7.d,tsc_CC7.2,tsc_CC7.3,</group>
  </rule>
  
  <rule id="110022" level="14">
    <if_matched_sid>110021</if_matched_sid>
    <description>Watchguard: Multiple ARP spoofing attacks detected. Possible attack ongoing</description>
    <group>spoofing,pci_dss_10.6.1,gpg13_4.12,gdpr_IV_35.7.d,tsc_CC7.2,tsc_CC7.3,</group>
  </rule>
  
  <rule id="110023" level="9">
    <if_sid>110000</if_sid>
    <id>3000-012E</id>
    <description>Watchguard: Cannot relearn system MAC address, possible loop or MAC spoofing, ip=$(srcip), mac=$(srcmac), interface=$(src)</description>
    <group>spoofing,pci_dss_10.6.1,gpg13_4.12,gdpr_IV_35.7.d,tsc_CC7.2,tsc_CC7.3,</group>
  </rule>
  
  <rule id="110024" level="14">
    <if_matched_sid>110023</if_matched_sid>
    <description>Watchguard: Multiple possible loops or MAC spoofing. Possible attack ongoing</description>
    <group>spoofing,pci_dss_10.6.1,gpg13_4.12,gdpr_IV_35.7.d,tsc_CC7.2,tsc_CC7.3,</group>
  </rule>
  
  <!-- ## DIAGNOSTIC RULES ## -->
  <rule id="110040" level="6">
    <if_sid>110000</if_sid>
    <id type="pcre2">3000-00C[9|B]</id>
    <description>Watchguard: Load Balance Server $(dstip) is offline, protocol $(protocol)</description>
	<group>service_availability,pci_dss_10.6.1,gpg13_4.12,gdpr_IV_35.7.d,tsc_CC7.2,tsc_CC7.3,</group>
  </rule>

  <rule id="110041" level="7">
    <if_sid>110000</if_sid>
    <id type="pcre2">4900-0001</id>
    <description>Watchguard: Link Monitor: $(src) unable to resolve domain name $(dst)</description>
	<group>service_availability,pci_dss_10.6.1,gpg13_4.12,gdpr_IV_35.7.d,tsc_CC7.2,tsc_CC7.3,</group>
  </rule>
  
  <rule id="110042" level="7">
    <if_sid>110000</if_sid>
    <id type="pcre2">4900-0002</id>
    <description>Watchguard: Link Monitor: No response received on $(src) from $(protocol) host $(dstip) $(dstport)</description>
	<group>service_availability,pci_dss_10.6.1,gpg13_4.12,gdpr_IV_35.7.d,tsc_CC7.2,tsc_CC7.3,</group>
  </rule>
  
  <rule id="110043" level="7">
    <if_sid>110000</if_sid>
    <id type="pcre2">4900-0003</id>
    <description>Watchguard: Link Monitor: $(src) interface $(reason)</description>
	<group>service_availability,pci_dss_10.6.1,gpg13_4.12,gdpr_IV_35.7.d,tsc_CC7.2,tsc_CC7.3,</group>
  </rule>
  
  <!-- ## BLOCKED SITE NORMAL OPERATIONS ## -->
  <rule id="110050" level="3">
    <if_sid>110000</if_sid>
    <id>3000-0029</id>
    <description>Watchguard: $(srcip) will not be added to the blocked sites list because it is exempt</description>
  </rule>
  
  <rule id="110051" level="3">
    <if_sid>110000</if_sid>
    <id>3000-0040</id>
    <description>Watchguard: Idle timeout has occurred for blocked site $(srcip)</description>
  </rule>
 
  <rule id="110052" level="12">
    <if_sid>110000</if_sid>
    <id>3000-1002</id>
    <description>Watchguard: The Temporary Blocked Sites list is full (capacity=1000). The oldest entry $(srcip) was removed</description>
	<group>unwanted_traffic,access_denied,pci_dss_10.2.4,pci_dss_11.4,gpg13_4.12,gdpr_IV_35.7.d,tsc_CC6.1,tsc_CC6.8,tsc_CC7.2,tsc_CC7.3,</group>
  </rule>
  
  <rule id="110053" level="14" frequency="10" timeframe="240" ignore="90">
    <if_matched_sid>110052</if_matched_sid>
    <description>Watchguard: The Temporary Blocked Sites list cannot hold all the blocked sites. Probable DDoS attack ongoing</description>
	<group>unwanted_traffic,access_denied,pci_dss_10.2.4,pci_dss_11.4,gpg13_4.12,gdpr_IV_35.7.d,tsc_CC6.1,tsc_CC6.8,tsc_CC7.2,tsc_CC7.3,</group>
    <group>ddos</group>
  </rule>
 
  <rule id="110054" level="12">
    <if_sid>110000</if_sid>
    <id>3001-1001</id>
    <description>Watchguard: Temporarily blocking host $(srcip) - $(reason)</description>
	<group>unwanted_traffic,access_denied,pci_dss_10.2.4,pci_dss_11.4,gpg13_4.12,gdpr_IV_35.7.d,tsc_CC6.1,tsc_CC6.8,tsc_CC7.2,tsc_CC7.3,</group>
  </rule>
  
  <rule id="110055" level="14" frequency="10" timeframe="240" ignore="90">
    <if_matched_sid>110054</if_matched_sid>
    <description>Watchguard: Multiple blocked hosts in short timespan. Probable DDoS attack ongoing</description>
	<group>unwanted_traffic,access_denied,pci_dss_10.2.4,pci_dss_11.4,gpg13_4.12,gdpr_IV_35.7.d,tsc_CC6.1,tsc_CC6.8,tsc_CC7.2,tsc_CC7.3,</group>
    <group>ddos</group>
  </rule>
  
  <rule id="110056" level="3">
    <if_sid>110000</if_sid>
    <id>3001-1002</id>
    <description>Watchguard: Removing temporarily blocked host $(srcip) from list</description>
  </rule>
  
  <!-- ## PACKET FILTER RULES ## -->
  
  <!-- For the sake of disk space, we will match Allow packets with level 0 -->
  
  <!-- Normal allowed traffic -->
  <rule id="110060" level="0">
    <if_sid>110000</if_sid>
    <id>3000-0148</id>
    <action type="pcre2">[Aa]llow</action>
    <description>Watchguard: firewall: $(action) $(src) $(dst) packetlen=$(packetlen) $(protocol) iphlen=$(iphlen) ttl=$(ttl) from $(srcip):$(srcport) to $(dstip):$(dstport) - $(reason)</description>
    <group>packet_filter</group>
  </rule>
  
  <!-- layer 2 denied traffic / don't bother to keep, so set level=0 -->
  <rule id="110061" level="0">
    <if_sid>110000</if_sid>
    <id>3000-0148</id>
    <action type="pcre2">[Dd]eny</action>
    <match type="pcre2">0.0.0.0\s0.0.0.0\s0\s0</match>
    <description>Watchguard: firewall: Layer2 $(action) $(src) $(dst) packetlen=$(packetlen) $(protocol) iphlen=$(iphlen) ttl=$(ttl) from $(srcip):$(srcport) to $(dstip):$(dstport) - $(reason)</description>
    <group>packet_filter</group>
  </rule>
 
  <!-- Normal denied traffic -->
  <rule id="110062" level="3">
    <if_sid>110000</if_sid>
    <id>3000-0148</id>
    <action type="pcre2">[Dd]eny</action>
    <description>Watchguard: firewall: $(action) $(src) $(dst) packetlen=$(packetlen) $(protocol) iphlen=$(iphlen) ttl=$(ttl) from $(srcip):$(srcport) to $(dstip):$(dstport) - $(reason)</description>
    <group>packet_filter,packet_filter_deny</group>
  </rule>
  
    <!-- allowed App Control -->
  <rule id="110063" level="0">
    <if_sid>110000</if_sid>
    <id>3000-0149</id>
    <action type="pcre2">[Aa]llow</action>
    <description>Watchguard: App control: $(action) $(src) $(dst) packetlen=$(packetlen) $(protocol) iphlen=$(iphlen) ttl=$(ttl) from $(srcip):$(srcport) to $(dstip):$(dstport) - $(reason)</description>
    <group>packet_filter,app_control</group>
  </rule>
  
    <!--denied  App Control -->
  <rule id="110064" level="3">
    <if_sid>110000</if_sid>
    <id>3000-0149</id>
    <action type="pcre2">[Dd]eny</action>
    <description>Watchguard: App control: $(action) $(src) $(dst) packetlen=$(packetlen) $(protocol) iphlen=$(iphlen) ttl=$(ttl) from $(srcip):$(srcport) to $(dstip):$(dstport) - $(reason)</description>
    <group>packet_filter,packet_filter_deny,app_control</group>
  </rule>
  
  <!-- allowed IPS Traffic -->
  <rule id="110065" level="0">
    <if_sid>110000</if_sid>
    <id>3000-0150</id>
    <action type="pcre2">[Aa]llow</action>
    <description>Watchguard: App control: $(action) $(src) $(dst) packetlen=$(packetlen) $(protocol) iphlen=$(iphlen) ttl=$(ttl) from $(srcip):$(srcport) to $(dstip):$(dstport) - $(reason)</description>
    <group>packet_filter,ips</group>
  </rule>
  
  <!-- denied IPS Traffic -->
  <rule id="110066" level="3">
    <if_sid>110000</if_sid>
    <id>3000-0150</id>
    <action type="pcre2">[Dd]eny</action>
    <description>Watchguard: App control: $(action) $(src) $(dst) packetlen=$(packetlen) $(protocol) iphlen=$(iphlen) ttl=$(ttl) from $(srcip):$(srcport) to $(dstip):$(dstport) - $(reason)</description>
    <group>packet_filter,packet_filter_deny,ips</group>
  </rule>
  
  <!-- Multiple denied generic traffic -->
  <rule id="110067" level="13" frequency="5" timeframe="300">
    <if_matched_group>packet_filter_deny</if_matched_group>
    <same_srcip />
    <description>Watchguard: firewall: Multiple denied traffic from same source $(srcip)</description>
    <group>firewall</group>
  </rule>
  
  <!-- Traffic connection terminated, very verbose, hence level=0 -->
  <rule id="110068" level="0">
    <if_sid>110000</if_sid>
    <id>3000-0151</id>
    <description>Watchguard: firewall: Traffic connection terminated: $(action) $(src) $(dst)  $(protocol) from $(srcip):$(srcport) to $(dstip):$(dstport) - $(reason)</description>
    <group>firewall</group>
  </rule>
  
  <!-- Hostile traffic -->
  <rule id="110069" level="9">
    <if_sid>110000</if_sid>
    <id>3000-0178</id>
    <description>Watchguard: firewall: Hostile traffic $(action) $(src) $(dst) packetlen=$(packetlen) $(protocol) iphlen=$(iphlen) ttl=$(ttl) from $(srcip):$(srcport) to $(dstip):$(dstport) - $(reason)</description>
    <group>firewall</group>
  </rule>
  
  <!-- Multiple hostile traffic -->
  <rule id="110070" level="13" frequency="10" timeframe="240" ignore="90">
    <if_matched_sid>110069</if_matched_sid>
    <same_srcip />
    <description>Watchguard: firewall: Multiple hostile traffic from same source</description>
    <group>firewall</group>
  </rule>
  
  <!-- ICMP hidden tunnel detection when too much packets are larger than standard ICMP packet size

  Generic ping max packet size
  PING = 56 + 40 + 8 = 104
   Default LINUX size + IPv6 Header + ICMP Header

2021 Mar 21 22:01:42 FW-125852->192.168.100.254 Mar 21 23:01:42 FW-125852 FVE1032175935 firewall: msg_id="3000-0148" Allow Trusted Firebox 1300 icmp 20 128 192.168.100.99 192.168.100.254 8 0 id=1 seq=2  (Ping-00)
2021 Mar 21 22:01:42 FW-125852->192.168.100.254 Mar 21 23:01:42 FW-125852 FVE1032175935 firewall: msg_id="3000-0148" Allow Trusted Firebox 60 icmp 20 128 192.168.100.99 192.168.100.254 8 0 id=1 seq=2  (Ping-00)
-->
  <rule id="110080" level="4">
    <if_matched_sid>110060</if_matched_sid>
	<protocol>icmp</protocol>
    <field name="packetlen" type="pcre2">([0-9]{4,}|[1-9]0[5-9]|1[1-9][0-9]|[2-9][0-9]{2})</field>
	<description>Watchguard: firewall: $(action) from $(srcip) to $(dstip) using protocol $(protocol) packet size is bigger than usual: $(packetlen)</description>
  </rule>
  
  <rule id="110081" level="14" frequency="10" timeframe="240" ignore="90">
    <if_matched_sid>110080</if_matched_sid>
	<same_srcip />
	<description>Watchguard: firewall: Possible $(protocol) tunnel attack from $(srcip) on interface $(src) to $(dstip) on interface $(dst)</description>
	<group>hidden_tunnel,pci_dss_10.6.1,pci_dss_11.4,gpg13_4.12,gdpr_IV_35.7.d,tsc_CC7.2,tsc_CC7.3,tsc_CC6.1,tsc_CC6.8,</group>
  </rule>
  
   <!--DNS hidden tunnel detection when too much packets are larger than standard DNS request size
  
DNS Nom de domaine < 63 caractères 
Taille de la requête IPv4 = 112
IPv4 + IPv6 = 112 + 20 = 132
(63 letters).(63 letters).(63 letters).(62 letters) = 260 IPv4 (FQDN max length)
https://devblogs.microsoft.com/oldnewthing/20120412-00/?p=7873

Mar 21 23:43:20 FW-125852 FVE1032175935 firewall: msg_id="3000-0148" Allow Firebox External 156 udp 20 64 10.0.1.2 213.133.99.99 47189 53  (Any From Firebox-00)
Mar 21 23:47:28 FW-125852 FVE1032175935 firewall: msg_id="3000-0148" Allow Firebox External 60 udp 20 64 fe80::20c:29ff:fe59:7afa ac::d0:::1 47189 53  (Any From Firebox-00)
-->

  <rule id="110082" level="4">
    <if_matched_sid>110060</if_matched_sid>
	<protocol>dns</protocol>
    <field name="packetlen" type="pcre2">([0-9]{4,}|[1-9]3[3-9]|1[4-9][0-9]|[2-9][0-9]{2})</field>
	<description>Watchguard: firewall: $(action) from $(srcip) to $(dstip) using protocol $(protocol) packet size is bigger than usual: $(packetlen)</description>
  </rule>
  
  <rule id="110083" level="14" frequency="10" timeframe="240" ignore="90">
    <if_matched_sid>110082</if_matched_sid>
	<same_srcip />
	<description>Watchguard: firewall: Possible $(protocol) tunnel attack from $(srcip) on interface $(src) to $(dstip) on interface $(dst)</description>
	<group>hidden_tunnel,pci_dss_10.6.1,pci_dss_11.4,gpg13_4.12,gdpr_IV_35.7.d,tsc_CC7.2,tsc_CC7.3,tsc_CC6.1,tsc_CC6.8,</group>
  </rule>

  <!--NTP hidden tunnel detection when too much packets are larger than standard NTP packet size

NTP Taille de la requête = 76
Taille de la requête + Entête IPv6 = 96

Apr 15 12:10:53 FW-125852 FVE1032175935 firewall: msg_id="3000-0148" Allow Trusted External 76 udp 20 63 192.168.100.250 162.159.200.123 48216 123  (Outgoing-00)
Apr 15 12:10:53 FW-125852 FVE1032175935 firewall: msg_id="3000-0148" Allow Trusted External 76 udp 20 63 fe80::20c:29ff:fe59:7afa ac::d0:::1 48216 123  (Outgoing-00)
-->

  <rule id="110084" level="4">
    <if_matched_sid>110060</if_matched_sid>
	<protocol>ntp</protocol>
    <field name="packetlen" type="pcre2">([1-9][0-9]{2,}|[2-9][0-9]|1[0-9])[0-9]{1}|([9-9][7-9])</field>
	<description>Watchguard: firewall: $(action) from $(srcip) to $(dstip) using protocol $(protocol) packet size is bigger than usual: $(packetlen)</description>
  </rule>
  
  <rule id="110085" level="14" frequency="10" timeframe="240" ignore="90">
    <if_matched_sid>110084</if_matched_sid>
	<same_srcip />
	<description>Watchguard: firewall: Possible $(protocol) tunnel attack from $(srcip) on interface $(src) to $(dstip) on interface $(dst)</description>
	<group>hidden_tunnel,pci_dss_10.6.1,pci_dss_11.4,gpg13_4.12,gdpr_IV_35.7.d,tsc_CC7.2,tsc_CC7.3,tsc_CC6.1,tsc_CC6.8,</group>
  </rule>

  <rule id="110086" level="14" frequency="10" timeframe="240" ignore="90"> <!-- NOOK -->
    <if_matched_group>hidden_tunnel</if_matched_group>
	<description>Watchguard: Possible multiple tunnel attacks ongoing. Please have a look</description>
	<group>pci_dss_10.6.1,pci_dss_11.4,gpg13_4.12,gdpr_IV_35.7.d,tsc_CC7.2,tsc_CC7.3,tsc_CC6.1,tsc_CC6.8,</group>
  </rule>
    
  <!-- ## PROXY FILTER RULES ## -->
  
  <!-- allowed proxy traffic is level 0 for disk space reasons -->
  <rule id="110090" level="0">
    <if_sid>110000</if_sid>
	<id type="pcre2">[1-2][0-9A-F]FF-[0-F]{4}</id>
	<action type="pcre2">[Aa]llow</action>
	<description>Watchguard: proxy: $(action) from $(src) to $(dst), $(protocol) from $(srcip):$(srcport) to $(dstip):$(dstport) - $(reason)</description>
	<group>proxy</group>
  </rule>
  
  <!-- denied proxy traffic -->
  <rule id="110091" level="3">
    <if_sid>110000</if_sid>
	<id type="pcre2">[1-2][0-9A-F]FF-[0-F]{4}</id>
	<action type="pcre2">[Dd]eny</action>
	<description>Watchguard: proxy: $(action) from $(src) to $(dst), $(protocol) from $(srcip):$(srcport) to $(dstip):$(dstport) - $(reason)</description>
	<group>proxy</group>
  </rule>
  
  <!-- Multiple proxy traffic -->
  <rule id="110092" level="13" frequency="10" timeframe="240" ignore="90">
    <if_matched_sid>110091</if_matched_sid>
    <same_srcip />
    <description>Watchguard: proxy: Multiple denied traffic from same source</description>
    <group>proxy</group>
  </rule>
  
  <!-- Possible DDoS or botnet attack NOOK -->
  <rule id="110093" level="14" frequency="10" timeframe="240" ignore="90">
    <if_matched_sid>110092</if_matched_sid>
	<description>Watchguard: proxy: Multiple recidiving traffic sent from same sources. Possible DDoS attack</description>
	<group>ids,pci_dss_11.4,gpg13_4.12,gdpr_IV_35.7.d,tsc_CC6.1,tsc_CC6.8,tsc_CC7.2,tsc_CC7.3,</group>
  </rule>

  <!-- APT THREAT -->
  <rule id="110030" level="12">
    <if_sid>110000</if_sid>
    <id>0F01-0015</id>
    <description>Watchguard: $(reason) from $(srcip):$(srcport) to $(dstip):$(dstport) - $(data)</description>
	<group>ids,pci_dss_11.4,gpg13_4.12,gdpr_IV_35.7.d,tsc_CC6.1,tsc_CC6.8,tsc_CC7.2,tsc_CC7.3,</group>
  </rule>
  
  <!-- ## UNHANDLED LOGS -->
  <rule id="110100" level="3">
    <if_sid>110000</if_sid>
	<description>Watchguard: Unhandled $(id) log recorded</description>
  </rule>
  

</group>

<group name="syslog,watchguard,watchguard-auth">
  <rule id="110200" level="0">
    <decoded_as>watchguard-firebox-auth</decoded_as>
    <description>Grouping of Watchguard Firebox firewall rules</description>
  </rule>
  
  <rule id="110201" level="9">
    <if_sid>110200</if_sid>
    <id>1100-0005</id>
    <status>rejected</status>
    <description>Watchguard: $(account) user $(dstuser) login $(status) from $(srcip) - $(reason)</description>
	<mitre>
	  <id>T1133</id>
	</mitre>
    <group>wg_userloginfailed,authentication_failed,pci_dss_10.2.4,pci_dss_10.2.5,gpg13_7.8,gdpr_IV_35.7.d,gdpr_IV_32.2,tsc_CC6.1,tsc_CC6.8,tsc_CC7.2,tsc_CC7.3,</group>
  </rule>
  
    <rule id="110202" level="4">
    <if_sid>110200</if_sid>
    <id>5000-0001</id>
    <status>rejected</status>
    <description>Watchguard: $(account) user [$(dstuser)] login $(status) from $(srcip) - $(reason)</description>
	<mitre>
	  <id>T1133</id>
	</mitre>
    <group>wg_webloginfailed,authentication_failed,</group>
  </rule>
  
  <rule id="110203" level="10" frequency="5" timeframe="60" ignore="240">
    <if_matched_sid>110201</if_matched_sid>
    <same_source_ip/>
    <description>Watchguard: Multiple $(status) login for $(account) user $(dstuser) from $(srcip) - $(reason)</description>
	<mitre>
	  <id>T1110</id>
	  <id>T1133</id>
	</mitre>
    <group>wg_loginforce,authentication_failures,pci_dss_10.2.4,pci_dss_10.2.5,gpg13_7.8,gdpr_IV_35.7.d,gdpr_IV_32.2,tsc_CC6.1,tsc_CC6.8,tsc_CC7.2,tsc_CC7.3</group>
  </rule>
  
  <rule id="110204" level="10" frequency="5" timeframe="60" ignore="240">
    <if_matched_sid>110202</if_matched_sid>
    <same_source_ip/>
    <description>Watchguard: Multiple $(status) login for $(account) user [$(dstuser)] from $(srcip) - $(reason)</description>
    <mitre>
	  <id>T1110</id>
	  <id>T1133</id>
	</mitre>
    <group>wg_webloginforce,authentication_failures,pci_dss_10.2.4,pci_dss_10.2.5,gpg13_7.8,gdpr_IV_35.7.d,gdpr_IV_32.2,tsc_CC6.1,tsc_CC6.8,tsc_CC7.2,tsc_CC7.3</group>
  </rule>

  <rule id="110205" level="3">
    <if_sid>110200</if_sid>
    <id>3E00-0002</id>
    <status>logged in</status>
    <field name="account" negate="yes">SSL VPN</field>
    <description>Watchguard: $(account) user [$(dstuser)] is $(status) from $(srcip)</description>
    <mitre>
	  <id>T1078</id>
	  <id>T1133</id>
	</mitre>
    <group>wg_loginsuccess,authentication_success,pci_dss_10.2.5,gpg13_7.8,gdpr_IV_32.2,tsc_CC6.8,tsc_CC7.2,tsc_CC7.3,</group>
  </rule>

  <rule id="110206" level="3">
    <if_sid>110200</if_sid>
    <id>2500-0000</id>
    <status>logged in</status>
    <field name="virtip" negate="yes">0.0.0.0</field>
    <description>Watchguard: Mobile VPN user [$(dstuser)] is $(status) from $(srcip) - Virtual IP is $(virtip)</description>
	<mitre>
	  <id>T1078</id>
	  <id>T1133</id>
	</mitre>
    <group>wg_vpnloginsuccess,authentication_success,pci_dss_10.2.5,gpg13_7.8,gdpr_IV_32.2,tsc_CC6.8,tsc_CC7.2,tsc_CC7.3,</group>
  </rule>

  <rule id="110207" level="9">
    <if_sid>110200</if_sid>
    <id>SSL VPN</id> <!-- NOOK TO TET -->
    <status>rejected</status>
    <description>Watchguard: SSL VPN user [$(dstuser)] connection $(status) from $(srcip) - $(reason)</description>
	<mitre>
	  <id>T1133</id>
	</mitre>
    <group>wg_vpnloginfailed,authentication_failed,pci_dss_10.2.4,pci_dss_10.2.5,gpg13_7.8,gdpr_IV_35.7.d,gdpr_IV_32.2,tsc_CC6.1,tsc_CC6.8,tsc_CC7.2,tsc_CC7.3,</group>
  </rule>
</group>

<var name="SIGD_BAD_WORDS">[Ff]ailed|crash|shutdown</var>

<group name="syslog,watchguard,watchguard-sigd">
  <rule id="110300" level="0">
    <decoded_as>watchguard-firebox-sigd</decoded_as>
    <description>Grouping of Watchguard Firebox security event rules</description>
  </rule>
  
  <!-- msg_id does not allow to determine the security event log level, hence we cannot decide of a reasonable alert level easily, we need to match keywords -->
  <rule id="110301" level="9">
    <if_sid>110300</if_sid>
	<match type="pcre2">$SIGD_BAD_WORDS</match>
	<description>Watchguard: Security event ERROR: $(reason)</description>
	<group>system_error,pci_dss_10.6.1,pci_dss_11.4,gpg13_4.3,gdpr_IV_35.7.d,tsc_CC7.2,tsc_CC7.3,tsc_CC6.1,tsc_CC6.8,</group>
	<mitre>
	  <id>T1489</id>
	</mitre>
  </rule>

  <rule id="110302" level="3">
    <if_sid>110300</if_sid>
	<description>Watchguard: Security event: $(reason)</description>
  </rule>
</group>
  
